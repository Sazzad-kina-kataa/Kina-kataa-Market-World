<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KinaтАСKataa MARKET WORLD</title>
  <style>
    :root { --primary: #00bcd4; --secondary: #e0f7fa; }
    body { font-family: sans-serif; margin: 0; background: #fff; color: #333; }
    header { background: var(--primary); color: white; padding: 15px; text-align: center; }
    .filter-bar { display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; background: var(--secondary); padding: 10px; }
    .filter-bar input, .filter-bar select { padding: 8px; border-radius: 5px; border: 1px solid #ccc; }
    .product-grid { display: grid; grid-template-columns: repeat(auto-fill,minmax(250px,1fr)); gap: 15px; padding: 15px; }
    .product-card { border: 1px solid #ddd; border-radius: 8px; padding: 10px; background: white; box-shadow: 0 1px 4px rgba(0,0,0,0.1); }
    .product-card h3 { margin: 10px 0 5px; font-size: 18px; }
    button { background: var(--primary); color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; }

    /* рж╕рзНрж▓рж╛ржЗржбрж╛рж░ рж╕рзНржЯрж╛ржЗрж▓ */
    .slider {
      position: relative;
      overflow: hidden;
      height: 180px;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    .slider .slides {
      display: flex;
      transition: transform 0.4s ease-in-out;
      height: 180px;
    }
    .slider .slides img {
      width: 100%;
      flex-shrink: 0;
      object-fit: cover;
      border-radius: 5px;
      user-select: none;
      -webkit-user-drag: none;
    }
    .slider .count-label {
      position: absolute;
      top: 5px;
      right: 10px;
      background: rgba(0,0,0,0.6);
      color: white;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      user-select: none;
    }
    .slider .slider-buttons {
      position: absolute;
      top: 50%;
      width: 100%;
      display: flex;
      justify-content: space-between;
      transform: translateY(-50%);
      pointer-events: none;
    }
    .slider .slider-buttons button {
      background: rgba(0,0,0,0.5);
      color: white;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      border-radius: 4px;
      user-select: none;
      pointer-events: auto;
    }

    #orderFormContainer {
      display: none; position: fixed; top:0; left:0; right:0; bottom:0;
      background: rgba(0,0,0,0.5); justify-content: center; align-items: center;
      z-index: 1000;
    }
    #orderForm {
      background: white; padding: 20px; border-radius: 10px;
      width: 90%; max-width: 400px;
    }
    #orderForm h2 { margin-top: 0; }
    #orderForm label { display: block; margin-top: 10px; }
    #orderForm input, #orderForm select {
      width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box;
    }
    #closeFormBtn { margin-top: 15px; background: #ccc; color: #000; }
    #totalPrice { font-weight: bold; margin-top: 15px; font-size: 16px; color: green; }
    footer { background:#333; color:#fff; text-align:center; padding:15px; margin-top: 40px; }
    footer a { color: #fff; text-decoration: underline; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes pulse {
      0% { color: #e91e63; }
      50% { color: #c2185b; }
      100% { color: #e91e63; }
    }
  </style>
</head>
<body>

<header>
  <h1>KinaтАСKataa MARKET WORLD</h1>
  <p>WhatsApp: 01728898569</p>
</header>

<!-- ржЕрж░рзНржбрж╛рж░ ржХрж░рж╛рж░ ржирж┐ржпрж╝ржо -->
<div style="background:#fffde7; padding:15px; margin:15px; border-left:5px solid #ffc107; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.05);">
  <h3 style="color:#d32f2f; margin-top:0;">ЁЯУМ ржмрж┐рж╢рзЗрж╖ ржжрзНрж░рж╖рзНржЯржмрзНржп / ржЕрж░рзНржбрж╛рж░ ржХрж░рж╛рж░ ржирж┐ржпрж╝ржо:</h3>

  <div id="noticeShort" style="font-size:16px; line-height:1.8;">
    <ul style="padding-left: 20px; margin:0;">
      <li>ржкржЫржирзНржж ржорждрзЛ ржкрзНрж░ржбрж╛ржХрзНржЯ рж╕рж┐рж▓рзЗржХрзНржЯ ржХрж░рзЗ тЬЕ ржЕрж░рзНржбрж╛рж░ ржХрж░рзБржиред</li>
      <li>ржлрж░рзНржо ржкрзВрж░ржг ржХрж░рзЗ ржХржиржлрж╛рж░рзНржо ржмрж╛ржЯржи ржирж╛ ржкрзЗрж▓рзЗ Enter ржЪрж╛ржкрзБржиред</li>
    </ul>
    <button onclick="toggleNotice()" style="margin-top:10px; background:#ffc107; border:none; padding:6px 12px; border-radius:6px; cursor:pointer;">ржЖрж░рзЛ ржжрзЗржЦрзБржи тмЗ</button>
  </div>

  <div id="noticeFull" style="display:none; font-size:16px; line-height:1.8;">
    <ul style="padding-left: 20px; margin:0;">
      <li>ржЖржкржирж╛ржжрзЗрж░ ржкржЫржирзНржж ржорждрзЛ ржкрзНрж░ржбрж╛ржХрзНржЯ рж╕рж┐рж▓рзЗржХрзНржЯ ржХрж░рзЗ <strong>тЬЕ ржЕрж░рзНржбрж╛рж░</strong> ржмрж╛ржЯржирзЗ ржХрзНрж▓рж┐ржХ ржХрж░рзБржиред</li>
      <li>рждрж╛рж░ржкрж░ <strong>ржлрж░рзНржоржЯрж┐ ржкрзВрж░ржг ржХрж░рзБржи</strong> (ржпржжрж┐ ржХржиржлрж╛рж░рзНржо ржмрж╛ржЯржи ржирж╛ ржжрзЗржЦрж╛ ржпрж╛ржпрж╝, рждрж╛рж╣рж▓рзЗ ржЖржкржирж╛рж░ ржорзЛржмрж╛ржЗрж▓рзЗрж░ ржХрж┐ржмрзЛрж░рзНржбрзЗ <strong>Enter</strong> ржЪрж╛ржкрзБржи)ред</li>
      <li>ржПржЦржи ржЖржкржирж╛ржХрзЗ <strong>WhatsApp</strong> ржП ржирж┐ржпрж╝рзЗ ржпрж╛ржмрзЗ ржЖржорж╛ржжрзЗрж░ ржЕржлрж┐рж╕рж┐ржпрж╝рж╛рж▓ ржЗржиржмржХрзНрж╕рзЗред</li>
      <li>ржЖржкржирж╛рж░ ржЕрж░рзНржбрж╛рж░/рждржерзНржп <strong>ржЯрж╛ржЗржкрж┐ржВ ржмржХрзНрж╕рзЗ ржкрзНрж░рж╕рзНрждрзБржд ржерж╛ржХржмрзЗ</strong>, ржЖржкржирж┐ рж╢рзБржзрзБ <strong>Send</strong> ржмрж╛ржЯржирзЗ ржХрзНрж▓рж┐ржХ ржХрж░рзБржиред</li>
      <li><span style="color:#d84315; font-weight:bold;">тЭЧ ржХрзЛржирзЛ ржнрзБрж▓ ржмрж╛ рж╕ржорж╕рзНржпрж╛ ржерж╛ржХрж▓рзЗ ржЪрж┐ржирзНрждрж╛ ржХрж░ржмрзЗржи ржирж╛</span> тАФ ржЖржкржирж╛рж░ ржЕрж░рзНржбрж╛рж░ рждржЦржирзЛ <strong>Pending</strong> ржЕржмрж╕рзНржерж╛ржпрж╝ ржерж╛ржХржмрзЗред</li>
      <li>ржЖржорж╛ржжрзЗрж░ ржЕржлрж┐рж╕ ржерзЗржХрзЗ <strong>ржпржд ржжрзНрж░рзБржд рж╕ржорзНржнржм ржХржиржлрж╛рж░рзНржорзЗрж╢ржи ржорзЗрж╕рзЗржЬ</strong> ржкрж╛ржарж╛ржирзЛ рж╣ржмрзЗред</li>
      <li>ржЖржкржирж┐ рждржЦржи <strong>рж░ржВ / ржкрж░рж┐ржорж╛ржг / ржарж┐ржХрж╛ржирж╛</strong> рж╕рж╣ рж╕ржм рждржерзНржп <strong>Edit</strong> ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржиред</li>
      <li>ржЖржорж░рж╛ ржЖржкржирж╛ржХрзЗ <strong>рж╕ржХрж▓ ржкрзНрж░ржХрж╛рж░ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░ржм</strong> ржЗржирж╢рж╛ржЖрж▓рзНрж▓рж╛рж╣ред ЁЯдЭ</li>
    </ul>
    <button onclick="toggleNotice()" style="margin-top:10px; background:#ffc107; border:none; padding:6px 12px; border-radius:6px; cursor:pointer;">тЖР рж▓рзБржХрж╛ржУ</button>
  </div>
</div>

<script>
  function toggleNotice() {
    const shortNotice = document.getElementById('noticeShort');
    const fullNotice = document.getElementById('noticeFull');
    if (shortNotice.style.display === 'none') {
      shortNotice.style.display = 'block';
      fullNotice.style.display = 'none';
    } else {
      shortNotice.style.display = 'none';
      fullNotice.style.display = 'block';
    }
  }
</script>

<div class="filter-bar">
  <input type="text" id="searchInput" placeholder="ржкржгрзНржп ржЦрзБржБржЬрзБржитАж" oninput="filterProducts()" />
  <select id="categorySelect" onchange="filterProducts()">
    <option value="all">рж╕ржХрж▓ ржмрж┐ржнрж╛ржЧ</option>
    <option value="mobile">ржорзЛржмрж╛ржЗрж▓</option>
    <option value="electronics">ржЗрж▓рзЗржХржЯрзНрж░ржирж┐ржХрзНрж╕</option>
    <option value="fashion">ржлрзНржпрж╛рж╢ржи</option>
    <option value="home decor">рж╣рзЛржо ржбрзЗржХрж░</option>
    <option value="grocery">ржЧрзНрж░рзЛрж╕рж╛рж░рж┐</option>
    <option value="beauty">ржмрж┐ржЙржЯрж┐</option>
    <option value="sports">рж╕рзНржкрзЛрж░рзНржЯрж╕</option>
    <option value="toys">ржЯржпрж╝рзЗржЬ</option>
    <option value="books">ржмржЗ</option>
  </select>
</div>

<div id="products" class="product-grid"></div>

<div id="orderFormContainer">
  <form id="orderForm" onsubmit="submitOrder(event)">
    <h2>ржЕрж░рзНржбрж╛рж░ ржлрж░рзНржо</h2>
    <p><strong>ржкржгрзНржп:</strong> <span id="formProductName"></span></p>
    <p><strong>ржорзВрж▓рзНржп:</strong> рз│<span id="formProductPrice"></span></p>
    <p><strong>ржбрзЗрж▓рж┐ржнрж╛рж░рж┐:</strong> рз│<span id="formDeliveryCharge"></span></p>

    <label for="colorSelect">рж░ржЩ:</label>
    <select id="colorSelect" required>
      <option value="">-- рж░ржЩ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи --</option>
      <option value="рж▓рж╛рж▓">рж▓рж╛рж▓</option>
      <option value="ржирзАрж▓">ржирзАрж▓</option>
      <option value="ржХрж╛рж▓рзЛ">ржХрж╛рж▓рзЛ</option>
      <option value="рж╕рж╛ржжрж╛">рж╕рж╛ржжрж╛</option>
      <option value="рж╕ржмрзБржЬ">рж╕ржмрзБржЬ</option>
    </select>

    <label for="quantityInput">ржкрж░рж┐ржорж╛ржг:</label>
    <input type="number" id="quantityInput" min="1" value="1" required/>

    <label for="nameInput">ржирж╛ржо:</label>
    <input type="text" id="nameInput" required/>

    <label for="phoneInput">ржорзЛржмрж╛ржЗрж▓:</label>
    <input type="tel" id="phoneInput" pattern="01[3-9][0-9]{8}" required/>

    <label for="addressInput">ржарж┐ржХрж╛ржирж╛:</label>
    <input type="text" id="addressInput" required/>

    <label for="locationInput">ржЬрзЗрж▓рж╛:</label>
    <input type="text" id="locationInput" required/>

    <label for="paymentMethod">ржкрзЗржорзЗржирзНржЯ ржкржжрзНржзрждрж┐:</label>
    <select id="paymentMethod" required onchange="togglePaymentProof()">
      <option value="">-- ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи --</option>
      <option value="cod">Cash on Delivery</option>
      <option value="bkash">Bkash</option>
      <option value="nagod">Nagad</option>
    </select>

    <div id="paymentProofFields" style="display:none;">
      <label for="paymentNumber">ржкрж╛ржарж╛ржирзЛ ржиржорзНржмрж░:</label>
      <input type="tel" id="paymentNumber" placeholder="рзжрззXXXXXXXXX" />
      <label for="transactionId">ржЯрзНрж░рж╛ржиржЬрзНржпрж╛ржХрж╢ржи ржЖржЗржбрж┐:</label>
      <input type="text" id="transactionId" />
    </div>

    <p id="totalPrice">ржорзЛржЯ ржмрж┐рж▓: рз│0</p>

    <button type="submit">тЬЕ ржЕрж░рзНржбрж╛рж░ ржХрж░рзБржи</button>
    <button type="button" id="closeFormBtn" onclick="closeOrderForm()">тЭМ ржмрж╛рждрж┐рж▓</button>
  </form>
</div>

<footer>
  <p>ржпрзЛржЧрж╛ржпрзЛржЧ: <a href="tel:01728898569">01728898569</a></p>
  <p>┬й 2025 KinaтАСKataa MARKET WORLD</p>
  <div style="text-align:center; margin-top:30px;">
  <span style="font-size:14px; color:#555; animation: fadeIn 2s ease-in-out, pulse 3s infinite;">
    тЪб Powered by <strong style="color:#e91e63;">MD SAZZAD HOWLADER</strong>
  </span>
</div>
</footer>
  <script>
const sheetURL = "https://script.google.com/macros/s/AKfycbzvkwRZMkx6f4W735HrljZm_ATD1G9v1JBi2oD2fVbNus_V8Ye6lq1dxQIswHLAwsau5Q/exec";
let allProducts = [], currentProduct = null;

// Google Drive рж▓рж┐ржВржХ ржХржиржнрж╛рж░рзНржЯ ржХрж░рж╛рж░ ржлрж╛ржВрж╢ржи
function convertDriveLink(url) {
  if (!url) return url;
  
  // Google Drive рж▓рж┐ржВржХ рж╣рж▓рзЗ
  if (url.includes('drive.google.com/file/d/')) {
    const match = url.match(/\/d\/([^\/]+)/);
    if (match && match[1]) {
      return `https://drive.google.com/uc?export=view&id=${match[1]}`;
    }
  }
  
  // Google Drive рж╢рзЗржпрж╝рж╛рж░рзЗржмрж▓ рж▓рж┐ржВржХ рж╣рж▓рзЗ
  if (url.includes('drive.google.com/open?id=')) {
    const match = url.match(/id=([^&]+)/);
    if (match && match[1]) {
      return `https://drive.google.com/uc?export=view&id=${match[1]}`;
    }
  }
  
  return url;
}

function createImageSlider(images) {
  const slider = document.createElement('div');
  slider.className = 'slider';

  const slides = document.createElement('div');
  slides.className = 'slides';

  images.forEach(src => {
    const img = document.createElement('img');
    img.src = convertDriveLink(src.trim()); // ржПржЦрж╛ржирзЗ рж▓рж┐ржВржХ ржХржиржнрж╛рж░рзНржЯ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ
    img.onerror = function() {
      this.style.display = 'none'; // ржЗржорзЗржЬ рж▓рзЛржб ржирж╛ рж╣рж▓рзЗ рж╣рж╛ржЗржб ржХрж░рзЗ ржжрзЗржпрж╝
    };
    slides.appendChild(img);
  });

  slider.appendChild(slides);

  const countLabel = document.createElement('div');
  countLabel.className = 'count-label';
  countLabel.textContent = `${images.length} ржЫржмрж┐`;
  slider.appendChild(countLabel);

  if (images.length > 1) {
    const buttons = document.createElement('div');
    buttons.className = 'slider-buttons';

    const prevBtn = document.createElement('button');
    prevBtn.textContent = 'тА╣';

    const nextBtn = document.createElement('button');
    nextBtn.textContent = 'тА║';

    buttons.appendChild(prevBtn);
    buttons.appendChild(nextBtn);
    slider.appendChild(buttons);

    let currentIndex = 0;
    function updateSlider() {
      slides.style.transform = `translateX(-${currentIndex * 100}%)`;
    }

    prevBtn.onclick = () => {
      currentIndex = (currentIndex - 1 + images.length) % images.length;
      updateSlider();
    };
    nextBtn.onclick = () => {
      currentIndex = (currentIndex + 1) % images.length;
      updateSlider();
    };
  }

  return slider;
}

async function fetchProducts() {
  const grid = document.getElementById("products");
  grid.innerHTML = "<p style='text-align:center;'>ЁЯФД ржкржгрзНржп рж▓рзЛржб рж╣ржЪрзНржЫрзЗ...</p>";
  try {
    const res = await fetch(sheetURL);
    const data = await res.json();
    allProducts = Array.isArray(data) ? data : Array.isArray(data.products) ? data.products : [];
    renderProducts(allProducts);
  } catch (err) {
    console.error(err);
    grid.innerHTML = "<p style='color:red;text-align:center;'>тЭМ ржкржгрзНржп рж▓рзЛржб рж╣рзЯржирж┐ред</p>";
  }
}

function renderProducts(products) {
  const grid = document.getElementById("products");
  grid.innerHTML = products.length ? "" : "<p style='text-align:center;'>ЁЯШФ ржХрзЛржи ржкржгрзНржп ржирзЗржЗред</p>";
  
  products.forEach(p => {
    const name = p.name || "ржирж╛ржо ржирзЗржЗ";
    const price = parseInt(p.price) || 0;
    const delivery = parseInt(p.delivery || p["delivery charge"]) || 0;
    const desc = p.description || "";
    const category = (p.category || "").toLowerCase();
    let photosStr = p.photos || p.photo || "";
    
    // Google Drive рж▓рж┐ржВржХ ржХржиржнрж╛рж░рзНржЯ ржХрж░рж╛
    const images = photosStr.split(',')
      .map(x => x.trim())
      .filter(x => x)
      .map(convertDriveLink);

    const card = document.createElement("div");
    card.className = "product-card";

    if (images.length) card.appendChild(createImageSlider(images));

    card.innerHTML += `
      <h3>${name}</h3>
      <p>${desc}</p>
      <p>ржорзВрж▓рзНржп: <strong>рз│${price}</strong></p>
      <p>ржбрзЗрж▓рж┐ржнрж╛рж░рж┐: <strong>рз│${delivery}</strong></p>
      <button onclick="openOrderForm('${name.replace(/'/g, "\\'")}', ${price}, ${delivery})">тЬЕ ржЕрж░рзНржбрж╛рж░</button>
    `;
    grid.appendChild(card);
  });
}

function filterProducts() {
  const query = document.getElementById("searchInput").value.toLowerCase();
  const category = document.getElementById("categorySelect").value;
  const filtered = allProducts.filter(p => {
    const name = (p.name || "").toLowerCase();
    const cat = (p.category || "").toLowerCase();
    return name.includes(query) && (category === "all" || cat === category);
  });
  renderProducts(filtered);
}

function openOrderForm(name, price, delivery) {
  currentProduct = { name, price, delivery };
  document.getElementById("formProductName").textContent = name;
  document.getElementById("formProductPrice").textContent = price;
  document.getElementById("formDeliveryCharge").textContent = delivery;
  document.getElementById("quantityInput").value = 1;
  calculateTotal();
  document.getElementById("orderFormContainer").style.display = "flex";
}

function closeOrderForm() {
  document.getElementById("orderFormContainer").style.display = "none";
}

function togglePaymentProof() {
  const method = document.getElementById("paymentMethod").value;
  const proof = document.getElementById("paymentProofFields");
  proof.style.display = (method === "bkash" || method === "nagod") ? "block" : "none";
}

function calculateTotal() {
  const qty = parseInt(document.getElementById("quantityInput").value) || 1;
  const total = currentProduct.price * qty + currentProduct.delivery;
  document.getElementById("totalPrice").textContent = `ржорзЛржЯ ржмрж┐рж▓: рз│${total}`;
}

document.getElementById("quantityInput").addEventListener("input", calculateTotal);

function submitOrder(event) {
  event.preventDefault();
  const color = document.getElementById("colorSelect").value;
  const qty = document.getElementById("quantityInput").value;
  const name = document.getElementById("nameInput").value;
  const phone = document.getElementById("phoneInput").value;
  const address = document.getElementById("addressInput").value;
  const location = document.getElementById("locationInput").value;
  const method = document.getElementById("paymentMethod").value;
  const payNum = document.getElementById("paymentNumber").value;
  const trx = document.getElementById("transactionId").value;

  let msg = `ЁЯЫТ ржЕрж░рзНржбрж╛рж░ржГ\n`;
  msg += `ЁЯФ╣ ржкржгрзНржп: ${currentProduct.name}\n`;
  msg += `ЁЯФ╣ рж░ржЩ: ${color}\n`;
  msg += `ЁЯФ╣ ржкрж░рж┐ржорж╛ржг: ${qty}\n`;
  msg += `ЁЯФ╣ ржорзВрж▓рзНржп: рз│${currentProduct.price}\n`;
  msg += `ЁЯФ╣ ржбрзЗрж▓рж┐ржнрж╛рж░рж┐: рз│${currentProduct.delivery}\n`;
  msg += `ЁЯФ╣ ржорзЛржЯ: рз│${currentProduct.price * qty + currentProduct.delivery}\n\n`;

  msg += `ЁЯСд ржХрзНрж░рзЗрждрж╛рж░ рждржерзНржп:\n`;
  msg += `ЁЯФ╕ ржирж╛ржо: ${name}\n`;
  msg += `ЁЯФ╕ ржорзЛржмрж╛ржЗрж▓: ${phone}\n`;
  msg += `ЁЯФ╕ ржарж┐ржХрж╛ржирж╛: ${address}\n`;
  msg += `ЁЯФ╕ ржЬрзЗрж▓рж╛: ${location}\n\n`;

  msg += `ЁЯТ│ ржкрзЗржорзЗржирзНржЯ: ${method}\n`;
  if (method !== "cod") {
    msg += `ЁЯФ╕ ржкрж╛ржарж╛ржирзЛ ржиржорзНржмрж░: ${payNum}\n`;
    msg += `ЁЯФ╕ TrxID: ${trx}\n`;
  }

  const whatsappLink = `https://wa.me/8801728898569?text=${encodeURIComponent(msg)}`;
  window.open(whatsappLink, "_blank");
  closeOrderForm();
}

window.onload = fetchProducts;
</script>
</body>
</html>